<form id="remote-form" novalidate>
  <div class="row g-3">
    <div class="col-md-6">
      <label for="remote_name" class="form-label">Nombre</label>
      <input type="text" class="form-control" id="remote_name" required placeholder="Ej: gdrive_respaldos">
    </div>
    <div class="col-md-6">
      <label for="remote_type" class="form-label">Tipo</label>
      <select class="form-select" id="remote_type" required>
        <option value="">Seleccione…</option>
        <option value="drive">Google Drive</option>
        <option value="onedrive">OneDrive</option>
        <option value="sftp">SFTP</option>
        <option value="local">Local</option>
      </select>
    </div>
  </div>

  <div id="remote-feedback" class="alert mt-4 d-none" role="alert"></div>

  <div class="mt-4" id="remote-type-panels">
    <div class="remote-panel d-none" data-remote-panel="local">
      <h2 class="h5">Destino local</h2>
      <p class="text-muted">Seleccioná una carpeta preconfigurada del servidor donde se guardarán los respaldos.</p>
      <div class="mb-3">
        <label for="local_path" class="form-label">Carpeta disponible</label>
        <select class="form-select" id="local_path"></select>
      </div>
      <div id="local-empty" class="alert alert-warning d-none" role="alert">
        No hay carpetas locales configuradas. Agregalas en la configuración del contenedor.
      </div>
    </div>

    <div class="remote-panel d-none" data-remote-panel="sftp">
      <h2 class="h5">Servidor SFTP</h2>
      <p class="text-muted">Ingresá los datos de conexión. Vamos a listar las carpetas disponibles y crear ahí una carpeta con el nombre del remote para guardar los respaldos.</p>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="sftp_host" class="form-label">Host</label>
          <input type="text" class="form-control" id="sftp_host" placeholder="sftp.ejemplo.com" autocomplete="off">
        </div>
        <div class="col-md-3">
          <label for="sftp_port" class="form-label">Puerto</label>
          <input type="number" class="form-control" id="sftp_port" min="1" max="65535" placeholder="22">
        </div>
        <div class="col-md-6">
          <label for="sftp_username" class="form-label">Usuario</label>
          <input type="text" class="form-control" id="sftp_username" autocomplete="username" placeholder="backup">
        </div>
        <div class="col-md-6">
          <label for="sftp_password" class="form-label">Contraseña</label>
          <input type="password" class="form-control" id="sftp_password" autocomplete="new-password" placeholder="••••••">
        </div>
      </div>
      <div class="form-text mt-2">
        Si dejás el puerto vacío se usará el valor por defecto (22).
      </div>
      <div class="mt-3">
        <button type="button" class="btn btn-outline-secondary" id="sftp-browse">Probar conexión y listar carpetas</button>
        <div id="sftp-browser-feedback" class="form-text mt-2 text-muted"></div>
      </div>
      <div id="sftp-browser-panel" class="border rounded p-3 mt-3 d-none">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
          <div><span class="fw-semibold">Carpeta actual:</span> <span id="sftp-current-path">/</span></div>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="sftp-browser-up" disabled>Subir un nivel</button>
            <button type="button" class="btn btn-sm btn-success" id="sftp-use-current">Usar esta carpeta</button>
          </div>
        </div>
        <p class="form-text mt-2 mb-0">Hacé clic en una carpeta para ver su contenido.</p>
        <ul class="list-group mt-3" id="sftp-directory-list"></ul>
        <div id="sftp-empty" class="alert alert-warning mt-3 d-none" role="alert">
          No encontramos subcarpetas en esta ubicación. Podés usarla igual para guardar los respaldos.
        </div>
      </div>
      <input type="hidden" id="sftp_base_path" value="">
      <div id="sftp-selected-path" class="form-text mt-2 text-muted">
        Todavía no elegiste la carpeta donde se crearán los respaldos.
      </div>
    </div>

    <div class="remote-panel d-none" data-remote-panel="drive">
      <h2 class="h5">Google Drive</h2>
      <p>Seguí estos pasos para obtener el token manual:</p>
      <ol>
        <li>Abrí el asistente de rclone para Google Drive desde <a id="drive-doc-link" href="https://rclone.org/drive/" target="_blank" rel="noopener">la documentación oficial</a>.</li>
        <li>Generá un token OAuth siguiendo las instrucciones de rclone.</li>
        <li>Pegá el JSON del token en el campo siguiente y probá la conexión.</li>
      </ol>
      <div class="mb-3">
        <label for="drive_token" class="form-label">Token de acceso</label>
        <textarea id="drive_token" class="form-control" rows="4" placeholder='{"access_token": "..."}'></textarea>
      </div>
      <button type="button" class="btn btn-outline-secondary" id="drive-test-token">Probar token</button>
      <div id="drive-token-feedback" class="form-text mt-2"></div>
    </div>

    <div class="remote-panel d-none" data-remote-panel="onedrive">
      <h2 class="h5">OneDrive</h2>
      <div class="alert alert-info" role="alert">
        Integración en construcción. Pronto vas a poder conectar OneDrive desde aquí.
      </div>
    </div>
  </div>

  <div class="mt-4">
    <button type="submit" class="btn btn-primary">Guardar remote</button>
  </div>
</form>
